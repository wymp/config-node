<!DOCTYPE html><html class="default" lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>config | @wymp/config-node</title><meta name="description" content="Documentation for @wymp/config-node"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="../assets/style.css"/><link rel="stylesheet" href="../assets/highlight.css"/><script async src="../assets/search.js" id="search-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os"</script><header class="tsd-page-toolbar">
<div class="tsd-toolbar-contents container">
<div class="table-cell" id="tsd-search" data-base="..">
<div class="field"><label for="tsd-search-field" class="tsd-widget search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><path d="M15.7824 13.833L12.6666 10.7177C12.5259 10.5771 12.3353 10.499 12.1353 10.499H11.6259C12.4884 9.39596 13.001 8.00859 13.001 6.49937C13.001 2.90909 10.0914 0 6.50048 0C2.90959 0 0 2.90909 0 6.49937C0 10.0896 2.90959 12.9987 6.50048 12.9987C8.00996 12.9987 9.39756 12.4863 10.5008 11.6239V12.1332C10.5008 12.3332 10.5789 12.5238 10.7195 12.6644L13.8354 15.7797C14.1292 16.0734 14.6042 16.0734 14.8948 15.7797L15.7793 14.8954C16.0731 14.6017 16.0731 14.1267 15.7824 13.833ZM6.50048 10.499C4.29094 10.499 2.50018 8.71165 2.50018 6.49937C2.50018 4.29021 4.28781 2.49976 6.50048 2.49976C8.71001 2.49976 10.5008 4.28708 10.5008 6.49937C10.5008 8.70852 8.71314 10.499 6.50048 10.499Z" fill="var(--color-text)"></path></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div>
<ul class="results">
<li class="state loading">Preparing search index...</li>
<li class="state failure">The search index is not available</li></ul><a href="../index.html" class="title">@wymp/config-node</a></div>
<div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><rect x="1" y="3" width="14" height="2" fill="var(--color-text)"></rect><rect x="1" y="7" width="14" height="2" fill="var(--color-text)"></rect><rect x="1" y="11" width="14" height="2" fill="var(--color-text)"></rect></svg></a></div></div></header>
<div class="container container-main">
<div class="col-8 col-content">
<div class="tsd-page-title">
<ul class="tsd-breadcrumb">
<li><a href="../modules.html">@wymp/config-node</a></li>
<li><a href="config.html">config</a></li></ul>
<h1>Function config</h1></div>
<section class="tsd-panel">
<ul class="tsd-signatures tsd-kind-function">
<li class="tsd-signature tsd-anchor-link" id="config">config<span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type" data-tsd-kind="Type parameter">Config</span><span class="tsd-signature-symbol">&gt;</span><span class="tsd-signature-symbol">(</span>ns<span class="tsd-signature-symbol">: </span><span class="tsd-signature-type">string</span>, src<span class="tsd-signature-symbol">: </span><span class="tsd-signature-symbol">{ </span>defaultsFile<span class="tsd-signature-symbol">?: </span><span class="tsd-signature-type">string</span><span class="tsd-signature-symbol">; </span>env<span class="tsd-signature-symbol">?: </span><span class="tsd-signature-symbol">{ </span>[k: <span class="tsd-signature-type">string</span>]<span class="tsd-signature-symbol">: </span><span class="tsd-signature-type">string</span><span class="tsd-signature-symbol"> | </span><span class="tsd-signature-type">undefined</span><span class="tsd-signature-symbol"> }</span><span class="tsd-signature-symbol">; </span>localsFile<span class="tsd-signature-symbol">?: </span><span class="tsd-signature-type">string</span><span class="tsd-signature-symbol">; </span>secretsDir<span class="tsd-signature-symbol">?: </span><span class="tsd-signature-type">string</span><span class="tsd-signature-symbol"> }</span>, validator<span class="tsd-signature-symbol">: </span><span class="tsd-signature-symbol">{ </span>check<span class="tsd-signature-symbol">: </span><span class="tsd-signature-symbol">(</span><span class="tsd-signature-symbol">(</span>config<span class="tsd-signature-symbol">: </span><span class="tsd-signature-type">any</span><span class="tsd-signature-symbol">)</span><span class="tsd-signature-symbol"> =&gt; </span><span class="tsd-signature-type" data-tsd-kind="Type parameter">Config</span><span class="tsd-signature-symbol">)</span><span class="tsd-signature-symbol"> }</span>, delimiter<span class="tsd-signature-symbol">?: </span><span class="tsd-signature-type">string</span><span class="tsd-signature-symbol">)</span><span class="tsd-signature-symbol">: </span><span class="tsd-signature-symbol">{ </span>config<span class="tsd-signature-symbol">: </span><span class="tsd-signature-type" data-tsd-kind="Type parameter">Config</span><span class="tsd-signature-symbol"> }</span><a href="#config" aria-label="Permalink" class="tsd-anchor-icon"><svg class="icon icon-tabler icon-tabler-link" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none" id="icon-anchor-a"></path><path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" id="icon-anchor-b"></path><path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" id="icon-anchor-c"></path></svg></a></li>
<li class="tsd-description">
<div class="tsd-comment tsd-typography"><p>Returns a type-checked config dependency created from environment variables and static files and
validates it using the given validator.</p>
<pre><code class="language-ts"><span class="hl-0">import</span><span class="hl-1"> </span><span class="hl-2">*</span><span class="hl-1"> </span><span class="hl-0">as</span><span class="hl-1"> </span><span class="hl-3">rt</span><span class="hl-1"> </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-4">&quot;runtypes&quot;</span><span class="hl-1">;</span><br/><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-3">config</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-4">&quot;@wymp/config-node&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">validator</span><span class="hl-1"> = </span><span class="hl-3">rt</span><span class="hl-1">.</span><span class="hl-7">Record</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-3">api:</span><span class="hl-1"> </span><span class="hl-3">rt</span><span class="hl-1">.</span><span class="hl-7">Record</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-3">url:</span><span class="hl-1"> </span><span class="hl-3">rt</span><span class="hl-1">.</span><span class="hl-3">String</span><span class="hl-1">,</span><br/><span class="hl-1">  }),</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-2">const</span><span class="hl-1"> </span><span class="hl-6">deps</span><span class="hl-1"> = </span><span class="hl-7">config</span><span class="hl-1">(</span><br/><span class="hl-1">  </span><span class="hl-4">`APP_`</span><span class="hl-1">,</span><br/><span class="hl-1">  {</span><br/><span class="hl-1">    </span><span class="hl-3">env:</span><span class="hl-1"> </span><span class="hl-3">process</span><span class="hl-1">.</span><span class="hl-3">env</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-3">defaultsFile:</span><span class="hl-1"> </span><span class="hl-4">&quot;config.json&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-3">localsFile:</span><span class="hl-1"> </span><span class="hl-4">&quot;config.local.json&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-3">secretsDir:</span><span class="hl-1"> </span><span class="hl-4">&quot;/secrets&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-3">validator</span><br/><span class="hl-1">);</span><br/><br/><span class="hl-3">console</span><span class="hl-1">.</span><span class="hl-7">log</span><span class="hl-1">(</span><span class="hl-3">deps</span><span class="hl-1">.</span><span class="hl-3">config</span><span class="hl-1">.</span><span class="hl-3">api</span><span class="hl-1">.</span><span class="hl-3">url</span><span class="hl-1">);</span>
</code></pre>
<p>To provide for corner cases, you may pass an explicit cast in the variable value itself, in
standard cast notation: <code>APP_my_var=&quot;&lt;string&gt;5&quot;</code> or <code>APP_db_port=&quot;&lt;string&gt;3306&quot;</code>. Without this
cast, values are coerced into the type they appear to be (numbers, in the case of the above, but
also null, undefined and booleans).</p>
<p>Additionally, since some orchestration systems make it difficult to re-use secret names, this
library also allows for a special syntax for overwriting old values. Environment variables and
files in the <code>secretsDir</code> may have a suffix of the type <code>__[nnn]</code> (two underscores and an
arbitrary number). For these variables, the suffix is stripped and the underlying variable name
is used instead. For example, the variables <code>APP_api_port__01=3000</code> and
<code>APP_api_port__02=3001</code> would result in the <code>config.api.port</code> variable having the value <code>3001</code>.</p>

<h3>Returns</h3><p>config A fully inflated and type-checked config dependency.</p>
</div>
<div class="tsd-type-parameters">
<h4 class="tsd-type-parameters-title">Type Parameters</h4>
<section class="tsd-panel tsd-type-parameters">
<h4>Type Parameters</h4>
<ul class="tsd-type-parameters">
<li>
<h4>Config</h4>
<div class="tsd-comment tsd-typography"><p>A (usually) inferred type defining the final type of the config object
returned. You should never really have to pass this type, as it is safely inferred from the
validator that you pass.</p>
</div></li></ul></section></div>
<div class="tsd-parameters">
<h4 class="tsd-parameters-title">Parameters</h4>
<ul class="tsd-parameter-list">
<li>
<h5>ns: <span class="tsd-signature-type">string</span></h5>
<div class="tsd-comment tsd-typography"><p>The prefix used to denote configuration variables for this application, including
trailing underscore. Usually something like <code>APP_</code> or <code>APP_CONFIG_</code>.</p>
</div></li>
<li>
<h5>src: <span class="tsd-signature-symbol">{ </span>defaultsFile<span class="tsd-signature-symbol">?: </span><span class="tsd-signature-type">string</span><span class="tsd-signature-symbol">; </span>env<span class="tsd-signature-symbol">?: </span><span class="tsd-signature-symbol">{ </span>[k: <span class="tsd-signature-type">string</span>]<span class="tsd-signature-symbol">: </span><span class="tsd-signature-type">string</span><span class="tsd-signature-symbol"> | </span><span class="tsd-signature-type">undefined</span><span class="tsd-signature-symbol"> }</span><span class="tsd-signature-symbol">; </span>localsFile<span class="tsd-signature-symbol">?: </span><span class="tsd-signature-type">string</span><span class="tsd-signature-symbol">; </span>secretsDir<span class="tsd-signature-symbol">?: </span><span class="tsd-signature-type">string</span><span class="tsd-signature-symbol"> }</span></h5>
<div class="tsd-comment tsd-typography"><p>A collection of potential sources from which to draw config. They are added in the
following order, where earlier sources are overridden by later sources:</p>
<p>  defaultsFile &lt; localsFile &lt; env &lt; secretsDir</p>
<p>File-based sources are expected to be JSON files; <code>env</code> should be <code>process.env</code>; and <code>secretsDir</code>
is a directory containing files whose names are converted to keys and whose contents are the
values. (This comes from the way docker presents secrets.) These key/value pairs are parsed in
the same way environment variables are (i.e., with value coercion, explicit casting, etc.).</p>
</div>
<ul class="tsd-parameters">
<li class="tsd-parameter">
<h5><code class="tsd-tag ts-flagOptional">Optional</code> defaults<wbr/>File<span class="tsd-signature-symbol">?: </span><span class="tsd-signature-type">string</span></h5>
<div class="tsd-comment tsd-typography"><p>Optional path to a file supplying default config values</p>
</div></li>
<li class="tsd-parameter">
<h5><code class="tsd-tag ts-flagOptional">Optional</code> env<span class="tsd-signature-symbol">?: </span><span class="tsd-signature-symbol">{ </span>[k: <span class="tsd-signature-type">string</span>]<span class="tsd-signature-symbol">: </span><span class="tsd-signature-type">string</span><span class="tsd-signature-symbol"> | </span><span class="tsd-signature-type">undefined</span><span class="tsd-signature-symbol"> }</span></h5>
<div class="tsd-comment tsd-typography"><p>The collection of environment variables (usually process.env)</p>
</div>
<ul class="tsd-parameters">
<li class="tsd-parameter-index-signature">
<h5><span class="tsd-signature-symbol">[</span>k: <span class="tsd-signature-type">string</span><span class="tsd-signature-symbol">]: </span><span class="tsd-signature-type">string</span><span class="tsd-signature-symbol"> | </span><span class="tsd-signature-type">undefined</span></h5></li></ul></li>
<li class="tsd-parameter">
<h5><code class="tsd-tag ts-flagOptional">Optional</code> locals<wbr/>File<span class="tsd-signature-symbol">?: </span><span class="tsd-signature-type">string</span></h5>
<div class="tsd-comment tsd-typography"><p>Optional path to a file supplying config overrides that are not checked into version control.
(This is for development convenience.)</p>
</div></li>
<li class="tsd-parameter">
<h5><code class="tsd-tag ts-flagOptional">Optional</code> secrets<wbr/>Dir<span class="tsd-signature-symbol">?: </span><span class="tsd-signature-type">string</span></h5>
<div class="tsd-comment tsd-typography"><p>A directory containing configs, one per file. File names are expected to comply with the same
rules as environment variables, and file contents are also processed in the same way as
env vars (i.e., with possible type-casts). This option is typically used with Docker/K8s
secrets.</p>
</div></li></ul></li>
<li>
<h5>validator: <span class="tsd-signature-symbol">{ </span>check<span class="tsd-signature-symbol">: </span><span class="tsd-signature-symbol">(</span><span class="tsd-signature-symbol">(</span>config<span class="tsd-signature-symbol">: </span><span class="tsd-signature-type">any</span><span class="tsd-signature-symbol">)</span><span class="tsd-signature-symbol"> =&gt; </span><span class="tsd-signature-type" data-tsd-kind="Type parameter">Config</span><span class="tsd-signature-symbol">)</span><span class="tsd-signature-symbol"> }</span></h5>
<div class="tsd-comment tsd-typography"><p>A validator that ensures the final config conforms to expectations. Usually a
<a href="https://github.com/pelotom/runtypes">runtype</a>. Note that if this is NOT a runtype, it should
be an object whose <code>check</code> property is a function that throws an error if the type is not as
expected and otherwise returns a concrete type. (If you want to gamble, you can bypass the
runtime type check by passing a pass-through function like so:
<code>{ check: (config: any): YourConfigType =&gt; config }</code>.)</p>
</div>
<ul class="tsd-parameters">
<li class="tsd-parameter">
<h5>check<span class="tsd-signature-symbol">: </span><span class="tsd-signature-symbol">(</span><span class="tsd-signature-symbol">(</span>config<span class="tsd-signature-symbol">: </span><span class="tsd-signature-type">any</span><span class="tsd-signature-symbol">)</span><span class="tsd-signature-symbol"> =&gt; </span><span class="tsd-signature-type" data-tsd-kind="Type parameter">Config</span><span class="tsd-signature-symbol">)</span></h5>
<ul class="tsd-parameters">
<li class="tsd-parameter-signature">
<ul class="tsd-signatures tsd-kind-type-literal tsd-parent-kind-type-literal">
<li class="tsd-signature"><span class="tsd-signature-symbol">(</span>config<span class="tsd-signature-symbol">: </span><span class="tsd-signature-type">any</span><span class="tsd-signature-symbol">)</span><span class="tsd-signature-symbol">: </span><span class="tsd-signature-type" data-tsd-kind="Type parameter">Config</span></li>
<li class="tsd-description">
<div class="tsd-parameters">
<h4 class="tsd-parameters-title">Parameters</h4>
<ul class="tsd-parameter-list">
<li>
<h5>config: <span class="tsd-signature-type">any</span></h5></li></ul></div>
<h4 class="tsd-returns-title">Returns <span class="tsd-signature-type" data-tsd-kind="Type parameter">Config</span></h4></li></ul></li></ul></li></ul></li>
<li>
<h5>delimiter: <span class="tsd-signature-type">string</span><span class="tsd-signature-symbol"> = &quot;_&quot;</span></h5>
<div class="tsd-comment tsd-typography"><p>If necessary, you may change the delimiter from the default &quot;_&quot; to something
else. This determines how config variables are nested. For example, the variable
<code>APP_my_db_port=3306</code> is usually converted to <code>{ my: { db: { port: 3306 } } }</code>. However, if you set
the <code>ns</code> parameter to <code>MYAPP0</code> and the <code>delimiter</code> parameter to <code>0</code>, then the value
<code>MYAPP0my_db0port=3306</code> would be converted to <code>{ my_db: { port: 3306 } }</code>.</p>
</div></li></ul></div>
<h4 class="tsd-returns-title">Returns <span class="tsd-signature-symbol">{ </span>config<span class="tsd-signature-symbol">: </span><span class="tsd-signature-type" data-tsd-kind="Type parameter">Config</span><span class="tsd-signature-symbol"> }</span></h4>
<ul class="tsd-parameters">
<li class="tsd-parameter">
<h5>config<span class="tsd-signature-symbol">: </span><span class="tsd-signature-type" data-tsd-kind="Type parameter">Config</span></h5></li></ul><aside class="tsd-sources">
<ul>
<li>Defined in <a href="https://github.com/wymp/config-node/blob/6aecb99/src/index.ts#L71">index.ts:71</a></li></ul></aside></li></ul></section></div>
<div class="col-4 col-menu menu-sticky-wrap menu-highlight">
<div class="tsd-navigation settings">
<details class="tsd-index-accordion"><summary class="tsd-accordion-summary">
<h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M4.93896 8.531L12 15.591L19.061 8.531L16.939 6.409L12 11.349L7.06098 6.409L4.93896 8.531Z" fill="var(--color-text)"></path></svg> Settings</h3></summary>
<div class="tsd-accordion-details">
<div class="tsd-filter-visibility">
<h4 class="uppercase">Member Visibility</h4><form>
<ul id="tsd-filter-options">
<li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li>
<li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-private" name="private"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Private</span></label></li>
<li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li>
<li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></form></div>
<div class="tsd-theme-toggle">
<h4 class="uppercase">Theme</h4><select id="theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div>
<nav class="tsd-navigation primary">
<details class="tsd-index-accordion" open><summary class="tsd-accordion-summary">
<h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M4.93896 8.531L12 15.591L19.061 8.531L16.939 6.409L12 11.349L7.06098 6.409L4.93896 8.531Z" fill="var(--color-text)"></path></svg> Modules</h3></summary>
<div class="tsd-accordion-details">
<ul>
<li><a href="../modules.html">@wymp/config-<wbr/>node</a>
<ul></ul></li></ul></div></details></nav>
<nav class="tsd-navigation secondary menu-sticky">
<ul>
<li class="current tsd-kind-function"><a href="config.html" class="tsd-index-link"><svg class="tsd-kind-icon" width="24" height="24" viewBox="0 0 24 24"><rect fill="var(--color-icon-background)" stroke="var(--color-ts-function)" stroke-width="1.5" x="1" y="1" width="22" height="22" rx="6" id="icon-64-path"></rect><path d="M9.39 16V7.24H14.55V8.224H10.446V11.128H14.238V12.112H10.47V16H9.39Z" fill="var(--color-text)" id="icon-64-text"></path></svg>config</a></li></ul></nav></div></div>
<div class="container tsd-generator">
<p>Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></div>
<div class="overlay"></div><script src="../assets/main.js"></script></body></html>